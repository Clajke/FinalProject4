trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

steps:
- checkout: self
- task: Docker@2
  displayName: Build and Push Docker image
  inputs:
    command: buildAndPush
    repository: clajke/devopsazurepipeline
    dockerfile: $(Build.SourcesDirectory)/Dockerfile
    containerRegistry: 'DockerHubConnection'  
    tags: |
      1.0
      latest

- task: AzureCLI@2
  displayName: 'Deploy to AKS'
  inputs:
    azureSubscription: 'AKS-Service-Connection'  
    scriptType: 'bash'
    scriptLocation: 'inlineScript'
    inlineScript: |
      az aks get-credentials --resource-group resource_group_1 --name jordaks --overwrite-existing
      kubectl apply -f $(Build.SourcesDirectory)/k8s-manifest.yaml

